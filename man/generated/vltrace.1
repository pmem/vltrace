.\" Automatically generated by Pandoc 1.16.0.2
.\"
.TH "strace" "1" "pmem Tools version 1.0.2" "" "" ""
.hy
.\" Copyright 2014-2017, Intel Corporation
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\"
.\"     * Redistributions of source code must retain the above copyright
.\"       notice, this list of conditions and the following disclaimer.
.\"
.\"     * Redistributions in binary form must reproduce the above copyright
.\"       notice, this list of conditions and the following disclaimer in
.\"       the documentation and/or other materials provided with the
.\"       distribution.
.\"
.\"     * Neither the name of the copyright holder nor the names of its
.\"       contributors may be used to endorse or promote products derived
.\"       from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
.\" "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
.\" LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
.\" A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
.\" OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
.\" SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
.\" LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
.\" OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.SH NAME
.PP
\f[B]vltrace\f[] \-\- extreamely fast strace\-like tool built on top
of eBPF and KProbe technologies.
.SH SYNOPSIS
.IP
.nf
\f[C]
$\ vltrace\ [options]\ [command\ [arg\ ...]]
\f[]
.fi
.SH DESCRIPTION
.PP
vltrace is a limited functional strace equivalent for Linux but
based on eBPF and KProbe technologies and libbcc library.
.SH FEATURES
.IP \[bu] 2
Used combination of technologies allow tool to be about one order faster
than regular system strace.
.IP \[bu] 2
This tool consume much less amount of CPU resource
.IP \[bu] 2
Output of this tool is designed to be suitable for processing with
classical tools and technologies, like awk.
.IP \[bu] 2
Could trace syscalls system\-wide.
.IP \[bu] 2
Could trace init (process with \[aq]pid == 1\[aq]).
Finally we have a proper tool for debugging systemd ;\-)
.PP
WARNING: System\-wide tracing can fill out your disk really fast.
.SH LIMITATIONS
.IP \[bu] 2
Limited functionality
.IP \[bu] 2
Slow attaching and detaching
.IP \[bu] 2
Asynchronity.
If user will not provide enough system resources for performance tool
will skip some calls.
Tool does not assume to try any work\-around behind the scene.
.IP \[bu] 2
Depend on modern kernel features
.IP \[bu] 2
Underlaing eBPF technology still is in active development.
So we should expect hangs and crashes more often as for regular strace,
especially on low\-res systems.
.IP \[bu] 2
Truncating of very long filenames (longer then ~STR_MAX bytes) to
~STR_MAX.
Details:
.RS 2
.IP \[bu] 2
https://github.com/iovisor/bcc/issues/900
.RE
.SH Outdated limitations
.PP
Could be useful with old libbcc versions.
.IP \[bu] 2
Limited possibility to run few instances simultaneously.
Details:
.RS 2
.IP \[bu] 2
https://github.com/iovisor/bcc/pull/918
.IP \[bu] 2
https://github.com/iovisor/bcc/issues/872
.RE
.SH SYSTEM REQUIREMENTS
.IP \[bu] 2
kernel v4.7 or later (to attach eBPF to tracepoints)
.IP \[bu] 2
kernel headers installed:
.RS 2
.IP \[bu] 2
\[aq]kernel\-devel\[aq] package on RHEL, Fedora and CentOS or
.IP \[bu] 2
\[aq]linux\-headers\[aq] package on Debian and Ubuntu
.RE
.IP \[bu] 2
libbcc v0.3.0-150-g3263805 or later
.IP \[bu] 2
CAP_SYS_ADMIN capability (required by the bpf() syscall)
.IP \[bu] 2
mounted tracefs
.SH OPTIONS
.SH Output format:
.PP
\f[C]\-o,\ \-\-output\ <file>\f[]
.PP
filename
.PP
\f[C]\-t,\ \-\-timestamp\f[]
.PP
include timestamp in output
.PP
\f[C]\-l,\ \-\-format\ <fmt>\f[]
.PP
output logs format.
Possible values:
.IP
.nf
\f[C]
\[aq]bin\[aq],\ \[aq]binary\[aq],\ \[aq]hex\[aq],\ \[aq]hex_raw\[aq],\ \[aq]hex_sl\[aq],\ \[aq]strace\[aq],\ \[aq]list\[aq]\ &\ \[aq]help\[aq].
\f[]
.fi
.IP \[bu] 2
\[aq]bin\[aq]/\[aq]binary\[aq] file format is the fastest one and is
described in generated trace.h.
If current directory is not writable generating of trace.h is skipped.
.IP \[bu] 2
\[aq]hex\[aq]/\[aq]hex_raw\[aq] the fastest text log format.
Records for some calls could be splitted in few lines if used with
\[aq]\-\-filenames name_max\[aq] or like.
.IP \[bu] 2
\[aq]hex_sl\[aq] one\-line text log format.
Assembling syscall\[aq]s record into one line by this tool will improove
readability and simplify processing but could slowdown this tool if used
with \[aq]\-\-filenames name_max\[aq] or \[aq]\-\-filenames full\[aq].
Implementation is not finished and is postponned.
.IP \[bu] 2
\[aq]strace\[aq] is going to emulate usual strace output, but is the
slowest one.
Assume assembling syscall\[aq]s packets into one line.
Implementation is not finished and is postponned.
.PP
Default: \[aq]hex\[aq]
.PP
\f[C]\-K,\ \-\-hex\-separator\ <sep>\f[]
.PP
set field separator for hex logs.
Default is a single space \[aq] \[aq].
.SH Filtering:
.PP
\f[C]\-X,\ \-\-failed\f[]
.PP
only show failed syscalls
.PP
\f[C]\-e,\ \-\-expr\ <expr>\f[]
.PP
expression, \[aq]help\[aq] or \[aq]list\[aq] for supported list.
.PP
Default: trace=kp\-kern\-all.
.SH Tracing:
.PP
\f[C]\-f,\ \-\-full\-follow\-fork\f[]
.PP
Follow new processes created with fork()/vfork()/clone() syscall as
regular strace does.
.PP
\f[C]\-ff,\ \-\-full\-follow\-fork=f\f[]
.PP
Same as above, but put logs for each process in separate file with name
<file>.pid Implementation is not finished and is postponned.
.PP
\f[C]\-fff,\ \-\-full\-follow\-fork=ff\f[]
.PP
Same as above, but put logs for each thread in separate file with name
<file>.tid.pid Implementation is not finished and is postponned.
.PP
\f[C]\-n,\ \-\-filenames\ <mode>\f[]
.PP
eBPF virtual machine is extremely limited in available memory.
Also currently there are no ways to calculate a len of strings.
For this reason we introduced four modes of fetching file\-names: \-
\[aq]fast\[aq] \- everything what we could not fit into single packet
will be truncated.
\- \[aq]name_max\[aq] \- fetch\-up STR_MAX bytes of name.
Every name will be sent via separate packet.
Processing of that packets is controlled by output log format.
\- \[aq]number\[aq] \- fetch\-up \[aq]number * STR_MAX\[aq] bytes of
name.
Every part of name will be sent via separate packet.
Processing of that packets is controlled by output log format.
Minimal accepted value: 1.
Implementation is not finished and is postponned.
\- \[aq]full\[aq] \- will be implemented as soon as this issue will be
fixed: https://github.com/iovisor/bcc/issues/900
.PP
Default: fast
.SH Startup:
.PP
\f[C]\-p,\ \-\-pid\ <pid>\f[]
.PP
trace this PID only.
In current version \f[C]command\f[] arg should be missing.
Press (CTRL\-C) to send interrupt signal to exit.
Note
.IP
.nf
\f[C]
\-p\ "`pidof\ PROG`"
\f[]
.fi
.PP
syntax.
.PP
\f[C]\-N,\ \-\-ebpf\-src\-dir\ <dir>\f[]
.PP
Enable checking of updated ebpf templates in directory <dir>.
.SH Miscellaneous:
.PP
\f[C]\-d,\ \-\-debug\f[]
.PP
enable debug output
.PP
\f[C]\-h,\ \-\-help\f[]
.PP
print help
.PP
\f[C]\-L,\ \-\-list\f[]
.PP
Print a list of all traceable syscalls of the running kernel.
.PP
\f[C]\-R,\ \-\-ll\-list\f[]
.PP
Print a list of all traceable low\-level funcs of the running kernel.
.PP
WARNING: really long.
~45000 functions for 4.4 kernel.
.PP
\f[C]\-B,\ \-\-builtin\-list\f[]
.PP
Print a list of all known syscalls.
.SH CONFIGURATION
.PP
** System Configuring **
.IP "1." 3
You should provide permissions to access tracefs for final user
according to your distro documentation.
Some of possible options:
.RS 4
.IP \[bu] 2
In /etc/fstab add mode=755 option for debugfs AND tracefs.
.IP \[bu] 2
Use sudo
.RE
.IP "2." 3
It\[aq]s good to put this command in init scripts such as local.rc:
.RS 4
.PP
echo 1 > /proc/sys/net/core/bpf_jit_enable
.PP
It will significantly improve performance and avoid \[aq]Lost
events\[aq]
.RE
.IP "3." 3
You should increase "Open File Limit" according to your distro
documentation.
Few common ways you can find in this instruction:
.RS 4
.PP
https://easyengine.io/tutorials/linux/increase\-open\-files\-limit/
.RE
.IP "4." 3
Kernel headers for running kernel should be installed.
.IP "5." 3
CAP_SYS_ADMIN capability should be provided for user for bpf() syscall.
In the newest kernel (4.10 ?) there is alternate option, but your should
found it youself.
.SH FILES
.PP
Putting into directory, supplied with \-N option, modified template
files allow to customize eBPF code for supporting more newer eBPF VM
features in newer kernels.
.PP
Also if current directory does not contain trace.h file, vltrace on
first start saves built\-in trace.h into current directory.
Saved built\-in describe binary log\[aq]s format.
.IP \[bu] 2
trace.h
.IP \[bu] 2
\&...
.PP
The rest of files could be figured out by looking into debug output,
into eBPF source code.
.SH EXAMPLES
.SH Example output:
.PP
# ./vltrace \-l hex
.PP
\&./vltrace \-l hex
.PP
PID ERR RES SYSCALL ARG1 ARG2 ARG3 AUX_DATA
.PP
0000000000000AFD 000000000000000B FFFFFFFFFFFFFFFF read 0000000000000005
.PP
0000000000000427 0000000000000000 0000000000000020 read 000000000000000A
.PP
0000000000000B3D 0000000000000000 0000000000000001 write
000000000000001C
.PP
0000000000000B11 0000000000000000 0000000000000001 read 000000000000001B
.PP
0000000000000427 0000000000000000 0000000000000020 read 000000000000000A
.PP
0000000000000B3D 0000000000000000 0000000000000001 write
000000000000001C
.PP
0000000000000B11 0000000000000000 0000000000000001 read 000000000000001B
.PP
0000000000000B3D 0000000000000000 0000000000000001 write
000000000000001C
.PP
0000000000000B11 0000000000000000 0000000000000001 read 000000000000001B
.PP
0000000000000B3D 0000000000000000 0000000000000001 write
000000000000001C
.PP
0000000000000B11 0000000000000000 0000000000000001 read 000000000000001B
.PP
\&...
.PP
^C
.PP
#
.SH The \-p option can be used to filter on a PID, which is filtered
in\-kernel.
.PP
Here \-t option is used to print timestamps:
.PP
# ./vltrace \-l hex \-tp 2833
.PP
\&./vltrace \-l hex \-tp 2833 PID TIME(usec) ERR RES SYSCALL ARG1
ARG2 ARG3 AUX_DATA
.PP
0000000000000B11 0000000000000000 0000000000000000 0000000000000001 read
000000000000001B
.PP
0000000000000B11 0000000000004047 0000000000000000 0000000000000001 read
000000000000001B
.PP
0000000000000B11 0000000000008347 0000000000000000 0000000000000001 read
000000000000001B
.PP
0000000000000B11 000000000000C120 0000000000000000 0000000000000001 read
000000000000001B
.PP
0000000000000B11 000000000000C287 0000000000000000 0000000000000001 read
000000000000001B
.PP
0000000000000B11 000000000000C508 0000000000000000 0000000000000001 read
000000000000001B
.PP
0000000000000B11 0000000000010548 0000000000000000 0000000000000001 read
000000000000001B
.PP
0000000000000B11 00000000000144A4 0000000000000000 0000000000000001 read
000000000000001B
.PP
\&...
.PP
^C
.PP
#
.SH The \-X option only prints failed syscalls:
.PP
# ./vltrace \-l hex \-X mkdir .
.PP
\&./vltrace \-l hex \-X mkdir .
.PP
PID ERR RES SYSCALL ARG1 ARG2 ARG3 AUX_DATA
.PP
000000000000441A 0000000000000002 FFFFFFFFFFFFFFFF open
/usr/share/locale/en_US/LC_MESSAGES/coreutils.mo mkdir
.PP
000000000000441A 0000000000000002 FFFFFFFFFFFFFFFF open
/usr/share/locale/en/LC_MESSAGES/coreutils.mo mkdir
.PP
000000000000441A 0000000000000002 FFFFFFFFFFFFFFFF open
/usr/share/locale\-langpack/en_US/LC_MESSAGES/coreutils.mo mkdir
.PP
000000000000441A 0000000000000002 FFFFFFFFFFFFFFFF open
/usr/lib/x86_64\-linux\-gnu/charset.alias mkdir
.PP
000000000000441A 0000000000000002 FFFFFFFFFFFFFFFF open
/usr/share/locale/en_US/LC_MESSAGES/libc.mo mkdir
.PP
000000000000441A 0000000000000002 FFFFFFFFFFFFFFFF open
/usr/share/locale/en/LC_MESSAGES/libc.mo mkdir
.PP
000000000000441A 0000000000000002 FFFFFFFFFFFFFFFF open
/usr/share/locale\-langpack/en_US/LC_MESSAGES/libc.mo mkdir
.PP
000000000000441A 0000000000000002 FFFFFFFFFFFFFFFF open
/usr/share/locale\-langpack/en/LC_MESSAGES/libc.mo mkdir
.PP
#
.PP
The ERR column is the system error number.
Error number 2 is ENOENT: no such file or directory.
.SH SEE ALSO
.PP
\f[B]strace\f[](1), \f[B]bpf\f[](2),
\f[B]<https://github.com/pmem/vltrace>\f[].
.PP
Also Documentation/networking/filter.txt in kernel sources.
